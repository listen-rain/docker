version: '2'

services:
 nginx:
  ports:
   - "80:80"
  external_links:
   - "php"
   - "mysql"
  volumes:
   - "/www:/www" 
   - "/dockers/compose/71-php/nginx/nginx.conf:/etc/nginx/nginx.conf"
   - "/dockers/compose/71-php/nginx/logs:/etc/nginx/logs"
   - "/dockers/compose/71-php/nginx/conf.d:/etc/nginx/conf.d"
  container_name: "nginx"
  depends_on:
    - "php"
    - "mysql"
  image: "nginx"
  restart: "always"
  extra_hosts: 
    - "centos:172.20.0.1"
  networks: 
    appnet:
      ipv4_address: "172.20.0.5"

 php:
  ports:
   - "9000:9000"
  external_links:
   - "mysql"
   - "redis"
  volumes:
   - "/www:/www"
   - "/dockers/compose/71-php/php-fpm/7.1.15/logs:/logs"
  container_name: "php"
  image: "registry.cn-hangzhou.aliyuncs.com/listen/php-fpm-7.1.15"
  restart: "always"
  networks: 
    appnet:
      ipv4_address: "172.20.0.4"

 redis:
  ports:
   - "6379:6379"
  volumes:
   - "/dockers/compose/71-php/redis/data:/data"
   - "/dockers/compose/71-php/redis/redis.conf:/usr/local/etc/redis/redis.conf"
  container_name: "redis"
  image: "redis:4.0"
  restart: "always"
  command: redis-server /usr/local/etc/redis/redis.conf 
  networks:
    appnet: 
     ipv4_address: "172.20.0.3"

 mysql:
  ports:
   - "3306:3306"
  volumes:
   - "/www:/www"
   - "/dockers/compose/71-php/mysql/5.6/data:/var/lib/mysql"
   - "/dockers/compose/71-php/mysql/5.6/conf.d:/etc/mysql/conf.d"
  environment:
   MYSQL_ROOT_PASSWORD: "root"
  container_name: "mysql"
  image: "mysql:5.6"
  restart: "always"
  networks: 
    appnet:
      ipv4_address: "172.20.0.2"

networks:
  appnet:
    driver: "bridge"
    ipam: 
     driver: "default"
     config:
      - subnet: 172.20.0.0/24
        gateway: 172.20.0.1                   
                                       
